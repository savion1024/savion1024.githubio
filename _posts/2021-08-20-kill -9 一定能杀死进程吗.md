---
layout:     post
title:      KILL -9 一定能杀死进程吗
subtitle:   不能
date:       2021-08-20
author:     savion
header-img: img/post-bg-cook.jpg
catalog: true
tags:
- linux
---


## 结论

当然不能，首先init进程就无法杀死，毕竟它是所有进程的祖宗，你总不能把祖宗杀了吧。

## kill 和 kill -9 有啥区别

首先两者都是发送一个信号给指定进程，例如 kill 1。就是给进程号为1的进程发送了一个信号，那么不同的是哪里？当然就是信号不同。
两者所代表的信号其实是不同的，linux系统有很多种信号。可以分成两种，一种是可以被忽略的，即进程收到信号可以忽视，可以有自己的逻辑。
例如kill 代表的第15号信号 `SIGTERM`，一种是不可以被忽略的，比如kill -9 代表的第9号信号  `SIGKILL` 表示要强制关闭进程。
可能你会认为 既然都不可忽略，那么我是不是就一定能关闭这个进程。 其实不然，以下几种情况kill -9 无法杀死进程

- 出于僵尸状态的进程（Z）,结合僵尸进程的定义（无实体只有一个文件描述符）,显然无法杀死进程。
- 陷入`内核调用`的进程，处于“内核态 ”的资源默认忽略所有信号。所以无法杀死进程 一般此时状态为(D),不可中断状态睡眠（Uninterruptible Sleep）

## 进程如何处理信号

1. 当操作系统接收到信号时，它会将信号传递给相应的进程。
2. 进程收到信号后，如果已经注册了该信号的处理程序，则执行该程序。如果未注册，则执行默认的处理程序。
3. 处理程序可以执行任何必要的操作，例如记录日志或更改进程状态。
4. 处理程序完成后，进程将恢复执行原始代码。

可以看到，进程可以注册特定信号的处理程序，所以我们可以利用信号来做`优雅关闭`，当收到指定信号时，进程可以先处理完当前任务再退出。


## 参考
- <https://time.geekbang.org/column/intro/100020901> Linux 性能优化实战




